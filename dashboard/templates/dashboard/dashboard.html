{% extends 'base.html' %}
{% load static %}

{% block title %} Dashboard - {{ user.username }} {% endblock %}

{% block extra_css %}
<style>
.card {
  border: none;
  border-radius: 15px;
}
.card-header {
  border-radius: 15px 15px 0 0 !important;
}
.btn-group .btn {
  margin: 0 2px;
}
.table th {
  border-top: none;
  font-weight: 600;
}
.badge {
  font-size: 0.9em;
}
</style>
{% endblock extra_css %}

{% block content %}
<header class="masthead masthead-banner">
  <div class="container">
    <div class="masthead-heading text-uppercase">Welcome, {{ user.username }}</div>
    <div class="masthead-subheading">{{ user.is_superuser|yesno:"Admin Dashboard,Your Personal Dashboard" }}</div>
  </div>
</header>

<div class="container page-section">
  {% if user.is_superuser %}
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow">
          <div class="card-header bg-success text-white">
            <h3 class="mb-0"><i class="fas fa-spa me-2"></i>Treatment Management</h3>
          </div>
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <p class="text-muted mb-0">Manage all available treatments and pricing</p>
              <a href="{% url 'dashboard:treatment_add' %}" class="btn btn-success">
                <i class="fas fa-plus me-1"></i>Add New Treatment
              </a>
            </div>
            
            {% if treatments %}
            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead class="table-dark">
                  <tr>
                    <th scope="col"><i class="fas fa-spa me-1"></i>Treatment</th>
                    <th scope="col" class="text-center">30 mins</th>
                    <th scope="col" class="text-center">60 mins</th>
                    <th scope="col" class="text-center">120 mins</th>
                    <th scope="col" class="text-center">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for treatment in treatments %}
                  <tr>
                    <td>
                      <div class="fw-bold">{{ treatment.title }}</div>
                      <small class="text-muted">{{ treatment.description|truncatechars:50 }}</small>
                    </td>
                    <td class="text-center">
                      <span class="badge bg-light text-dark fs-6">£{{ treatment.half_hour }}</span>
                    </td>
                    <td class="text-center">
                      <span class="badge bg-light text-dark fs-6">£{{ treatment.one_hour }}</span>
                    </td>
                    <td class="text-center">
                      <span class="badge bg-light text-dark fs-6">£{{ treatment.two_hour }}</span>
                    </td>
                    <td class="text-center">
                      <div class="btn-group" role="group">
                        <a href="{% url 'dashboard:treatment_edit' treatment.pk %}" class="btn btn-outline-info btn-sm">
                          <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'dashboard:treatment_delete' treatment.pk %}" class="btn btn-outline-danger btn-sm">
                          <i class="fas fa-trash"></i>
                        </a>
                        <a href="{% url 'dashboard:send_newsletter' treatment.pk %}" class="btn btn-outline-success btn-sm">
                          <i class="fas fa-envelope"></i>
                        </a>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <div class="text-center py-4">
              <i class="fas fa-spa fa-3x text-muted mb-3"></i>
              <p class="text-muted">No treatments available. Add your first treatment!</p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="row">
      <div class="col-lg-6 mb-4">
        <div class="card shadow h-100">
          <div class="card-header bg-success text-white">
            <h4 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Upcoming Bookings</h4>
          </div>
          <div class="card-body">
            {% if future_bookings %}
            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th scope="col">Treatment</th>
                    <th scope="col">Date & Time</th>
                    <th scope="col">Duration</th>
                    <th scope="col">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for booking in future_bookings %}
                  <tr>
                    <td>
                      <div class="fw-bold text-success">{{ booking.treatment.title }}</div>
                    </td>
                    <td>
                      <div class="fw-bold">{{ booking.date|date:"M d, Y" }}</div>
                      <small class="text-muted">
                        {% with booking.start_time as start_time %}
                        {% if start_time.minute == 0 %}
                        {{ start_time|time:"g:00 A" }}
                        {% else %}
                        {{ start_time|time:"g:i A" }}
                        {% endif %}
                        {% endwith %}
                        - {{ booking.end_time|time:"g:i A" }}
                      </small>
                    </td>
                    <td>
                      <span class="badge bg-success">{{ booking.duration }} mins</span>
                    </td>
                    <td>
                      {% if booking.can_cancel %}
                        <a href="{% url 'dashboard:cancel_booking' booking.id %}" class="btn btn-outline-danger btn-sm">
                          <i class="fas fa-times me-1"></i>Cancel
                        </a>
                      {% else %}
                        <button class="btn btn-outline-secondary btn-sm" disabled title="Cannot cancel within 24 hours of appointment">
                          <i class="fas fa-ban me-1"></i>Too Late
                        </button>
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <div class="text-center py-4">
              <i class="fas fa-calendar-plus fa-3x text-muted mb-3"></i>
              <p class="text-muted mb-3">No upcoming bookings</p>
              <a href="{% url 'book_now' %}" class="btn btn-success">
                <i class="fas fa-plus me-1"></i>Book Now
              </a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-4">
        <div class="card shadow h-100">
          <div class="card-header bg-secondary text-white">
            <h4 class="mb-0"><i class="fas fa-history me-2"></i>Past Bookings</h4>
          </div>
          <div class="card-body">
            {% if past_bookings %}
            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th scope="col">Treatment</th>
                    <th scope="col">Date & Time</th>
                    <th scope="col">Duration</th>
                  </tr>
                </thead>
                <tbody>
                  {% for booking in past_bookings %}
                  <tr>
                    <td>
                      <div class="fw-bold">{{ booking.treatment.title }}</div>
                    </td>
                    <td>
                      <div class="fw-bold">{{ booking.date|date:"M d, Y" }}</div>
                      <small class="text-muted">
                        {% with booking.start_time as start_time %}
                        {% if start_time.minute == 0 %}
                        {{ start_time|time:"g:00 A" }}
                        {% else %}
                        {{ start_time|time:"g:i A" }}
                        {% endif %}
                        {% endwith %}
                        - {{ booking.end_time|time:"g:i A" }}
                      </small>
                    </td>
                    <td>
                      <span class="badge bg-secondary">{{ booking.duration }} mins</span>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <div class="text-center py-4">
              <i class="fas fa-history fa-3x text-muted mb-3"></i>
              <p class="text-muted">No past bookings</p>
            </div>
            {% endif %}
          </div>
          
    {% if cancelled_bookings %}
    <div class="row mb-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header bg-warning text-dark">
            <h4 class="mb-0"><i class="fas fa-ban me-2"></i>Cancelled Bookings</h4>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th scope="col">Treatment</th>
                    <th scope="col">Date & Time</th>
                    <th scope="col">Duration</th>
                    <th scope="col">Status</th>
                  </tr>
                </thead>
                <tbody>
                  {% for booking in cancelled_bookings %}
                  <tr>
                    <td>
                      <div class="fw-bold text-muted">{{ booking.treatment.title }}</div>
                    </td>
                    <td>
                      <div class="fw-bold">{{ booking.date|date:"M d, Y" }}</div>
                      <small class="text-muted">
                        {% with booking.start_time as start_time %}
                        {% if start_time.minute == 0 %}
                        {{ start_time|time:"g:00 A" }}
                        {% else %}
                        {{ start_time|time:"g:i A" }}
                        {% endif %}
                        {% endwith %}
                        - {{ booking.end_time|time:"g:i A" }}
                      </small>
                    </td>
                    <td>
                      <span class="badge bg-warning text-dark">{{ booking.duration }} mins</span>
                    </td>
                    <td>
                      <span class="badge bg-danger">Cancelled</span>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="card shadow">
          <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
          </div>
          <div class="card-body">
          <div class="row text-center">
            <div class="col-md-4 mb-3">
              <a href="{% url 'book_now' %}" class="btn btn-success btn-lg w-100 d-flex flex-column align-items-center justify-content-center">
                <i class="fas fa-calendar-plus fa-2x mb-2"></i>
                Book New Treatment
              </a>
            </div>
            <div class="col-md-4 mb-3">
              <a href="{% url 'treatments' %}" class="btn btn-outline-success btn-lg w-100 d-flex flex-column align-items-center justify-content-center">
                <i class="fas fa-spa fa-2x mb-2"></i>
                View Treatments
              </a>
            </div>
            <div class="col-md-4 mb-3">
              <a href="{% url 'contact' %}" class="btn btn-outline-success btn-lg w-100 d-flex flex-column align-items-center justify-content-center">
                <i class="fas fa-envelope fa-2x mb-2"></i>
                Contact Us
              </a>
            </div>
          </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div>




{% endblock %}
